<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reports - FacultyFlow</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
  body {
    margin: 0;
    font-family: 'Roboto', sans-serif;
    background: #f5f8fa;
    color: #223365;
    position: relative;
    min-height: 100vh;
    overflow-x: hidden;
  }
  canvas#bgCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    pointer-events: none;
    z-index: 0;
    opacity: 0.32;
  }
  .navbar {
    width: 100%;
    background: #178d85;
    color: #fff;
    display: flex;
    align-items: center;
    padding: 0 24px;
    height: 60px;
    box-shadow: 0 4px 20px #08948c13;
    position: fixed;
    top: 0; z-index: 10;
  }
  .navbar .logo {
    font-weight: 700;
    font-size: 1.6rem;
    letter-spacing: 2px;
    margin-right: 36px;
  }
  .navbar nav {
    display: flex;
    gap: 34px;
    flex-grow: 1;
  }
  .navbar nav a {
    color: #dcf7f5;
    text-decoration: none;
    font-weight: 500;
    font-size: 1.07rem;
    padding: 8px 14px;
    border-radius: 8px;
    transition: background-color 0.3s, color 0.2s;
  }
  .navbar nav a:hover, .navbar nav a.active {
    color: #13a493;
    background-color: #e7f8f7;
  }
  .navbar .user-info {
    font-size: 1.01rem;
    opacity: .9;
    margin-left: 18px;
    user-select: none;
    color: #e2fcfd;
  }
  main {
    margin: 90px auto 48px auto;
    max-width: 1050px;
    padding: 0 18px;
    position: relative;
    z-index: 2;
  }
  h1 {
    font-size: 2.38rem;
    margin-bottom: 24px;
    font-weight: 700;
    color: #178d85;
    text-align: center;
    letter-spacing: 1px;
    text-shadow: 0 0 18px #6eebe024;
    user-select: none;
  }
  .filters {
    display: flex;
    align-items: center;
    gap: 18px;
    justify-content: center;
    margin-bottom: 28px;
    flex-wrap: wrap;
  }
  .filters label {
    font-weight: 600;
    font-size: 1.1rem;
    user-select: none;
  }
  .filters input[type="date"] {
    padding: 8px 14px;
    border-radius: 14px;
    border: 1.8px solid #4fd5cc93;
    font-size: 1.05rem;
    cursor: pointer;
    transition: border-color 0.3s ease;
  }
  .filters input[type="date"]:focus {
    border-color: #1dbba8;
    outline: none;
    box-shadow: 0 0 26px #1dbba899;
  }
  .filters button {
    background-color: #178d85;
    border: none;
    font-weight: 700;
    color: #e4fbf9;
    font-size: 1.1rem;
    padding: 14px 28px;
    border-radius: 18px;
    cursor: pointer;
    box-shadow: 0 0 26px #21c2b79d;
    transition: background-color 0.3s ease, transform 0.17s ease;
  }
  .filters button:hover {
    background-color: #0f665f;
    transform: scale(1.05);
  }
  .filters button:active {
    transform: scale(0.96);
  }
  .summary {
    display: flex;
    gap: 26px;
    justify-content: center;
    margin-bottom: 38px;
    flex-wrap: wrap;
  }
  .card {
    background: #0db89e;
    padding: 26px 36px;
    border-radius: 18px;
    box-shadow: 0 0 30px #0ab68b88;
    min-width: 240px;
    flex: 1 1 240px;
    color: #e4fbf9;
    text-align: center;
    user-select: none;
    transition: box-shadow 0.3s ease;
  }
  .card:hover {
    box-shadow: 0 0 48px #12b8a4cc;
  }
  .card h3 {
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 14px;
    text-shadow: 0 0 14px #abf0dd;
  }
  .card p {
    font-size: 3rem;
    font-weight: 900;
    letter-spacing: 1px;
    margin: 0;
  }
  .attendance-table-wrap {
    max-height: 480px;
    overflow-y: auto;
    box-shadow: 0 0 30px #05998333;
    border-radius: 18px;
    background: #e3f9f5;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1024px;
  }
  thead {
    background: #0db89e;
    color: #e4fbf9;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  th, td {
    padding: 14px 22px;
    text-align: left;
    font-size: 1.02rem;
    border-bottom: 1px solid #a0efdb;
  }
  tbody tr:hover {
    background-color: #c6f3e9;
  }
  td.status-present {
    color: #0a724f;
    font-weight: 700;
  }
  td.status-absent {
    color: #bc2828;
    font-weight: 700;
  }
  td.status-tardy {
    color: #bb700e;
    font-weight: 700;
  }
  td.rule-cell {
    font-size: 0.87rem;
    font-weight: 600;
    color: #0e5a45;
  }
  td.sent-cell {
    text-align: center;
  }
  td.sent-cell .checkmark {
    font-size: 1.35rem;
    color: #165c48;
  }
  @media (max-width: 1140px) {
    main {
      padding: 0 12px 40px;
    }
    table {
      min-width: 900px;
    }
    .summary {
      gap: 14px;
    }
  }
  @media (max-width: 600px) {
    main h1 {
      font-size: 2rem;
    }
    table {
      min-width: 700px;
      font-size: 0.9rem;
    }
    .card {
      font-size: 0.92rem;
      min-width: 190px;
    }
    .card p {
      font-size: 2.2rem;
    }
  }
</style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>
  <div class="navbar" role="navigation" aria-label="Primary navigation">
    <span class="logo">Attend Core</span>
    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a href="device.html">Devices</a>
      <a href="location.html">Locations</a>
      <a href="scan.html">Scans</a>
      <a href="student.html">Students</a>
      <a href="reports.html" class="active" aria-current="page">Reports</a>
      <a href="settings.html">Settings</a>
    </nav>
    <span class="right-info">Teapot Elementary | Dan | System Manager</span>
  </div>
  <main role="main" tabindex="-1">
    <h1>Attendance Reports</h1>
    <div class="filters" aria-label="Reports filters and actions">
      <label for="reportDatePicker">Select Date:</label>
      <input type="date" id="reportDatePicker" />
      <button id="exportCsvBtn" aria-label="Export report as CSV">Export CSV</button>
    </div>
    <div class="summary" aria-label="Attendance summary">
      <div class="card" id="overallAttendanceCard" tabindex="0" aria-live="polite" aria-atomic="true">
        <h3>Overall Attendance Rate</h3>
        <p id="overallAttendancePercent">--%</p>
      </div>
      <div class="card" id="atRiskStudentsCard" tabindex="0" aria-live="polite" aria-atomic="true">
        <h3>Students At Risk</h3>
        <p id="studentsAtRisk">--</p>
      </div>
      <div class="card" id="classroomSummaryCard" tabindex="0" aria-live="polite" aria-atomic="true">
        <h3>Classroom Attendance Summary</h3>
        <p id="classroomSummary">--</p>
      </div>
    </div>
    <div class="attendance-table-wrap" aria-label="Detailed attendance data">
      <table>
        <thead>
          <tr>
            <th>Student ID</th>
            <th>Class</th>
            <th>Date</th>
            <th>Batch</th>
            <th>Status</th>
            <th>Rule</th>
            <th>Sent</th>
          </tr>
        </thead>
        <tbody id="detailedAttendanceTbody"></tbody>
      </table>
    </div>
  </main>
<script>
  const attendanceData = [
    { studentId: '3101001', className: 'AIML-A', date: '2025-09-01', batch: 'Morning', status: 'Present', rule: 'Rule 1.1', sent: true },
    { studentId: '4101002', className: 'CSE-D', date: '2025-09-01', batch: 'Morning', status: 'Absent', rule: 'Rule 2.3', sent: true },
    { studentId: '5101003', className: 'IT-A', date: '2025-09-01', batch: 'Evening', status: 'Tardy', rule: 'Rule 3.0', sent: false }
  ];
  const summary = {
    overallAttendanceRate: 84,
    studentsAtRisk: 3,
    classroomSummary: '310: 24 present, 6 absent; 410: 20 present, 10 absent; 510: 15 present, 15 absent'
  };
  const reportDatePicker = document.getElementById('reportDatePicker');
  const exportCsvBtn = document.getElementById('exportCsvBtn');
  const overallAttendancePercent = document.getElementById('overallAttendancePercent');
  const studentsAtRisk = document.getElementById('studentsAtRisk');
  const classroomSummary = document.getElementById('classroomSummary');
  const detailedAttendanceTbody = document.getElementById('detailedAttendanceTbody');
  function renderSummary(){
    overallAttendancePercent.textContent = summary.overallAttendanceRate + '%';
    studentsAtRisk.textContent = summary.studentsAtRisk;
    classroomSummary.textContent = summary.classroomSummary;
  }
  function renderDetailedAttendance(dateFilter=''){
    detailedAttendanceTbody.innerHTML = '';
    let filteredData = attendanceData;
    if(dateFilter){
      filteredData = attendanceData.filter(el => el.date === dateFilter);
    }
    if(filteredData.length === 0){
      detailedAttendanceTbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 20px; color: #666;">No attendance records found.</td></tr>';
      return;
    }
    filteredData.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${row.studentId}</td><td>${row.className}</td><td>${row.date}</td><td>${row.batch}</td><td class="status-${row.status.toLowerCase()}">${row.status}</td><td class="rule-cell">${row.rule}</td><td style="text-align:center;">${row.sent ? '✔️' : ''}</td>`;
      detailedAttendanceTbody.appendChild(tr);
    });
  }
  function exportToCsv(){
    let csvContent = 'Student ID,Class,Date,Batch,Status,Rule,Sent\n';
    attendanceData.forEach(row => {
      csvContent += `${row.studentId},${row.className},${row.date},${row.batch},${row.status},${row.rule},${row.sent ? "Yes" : "No"}\n`;
    });
    const blob = new Blob([csvContent], {type:'text/csv;charset=utf-8;'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `attendance_report_${new Date().toISOString().slice(0,10)}.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
  reportDatePicker.addEventListener('change', e => { renderDetailedAttendance(e.target.value); });
  exportCsvBtn.addEventListener('click', exportToCsv);
  renderSummary();
  renderDetailedAttendance();

  // Background node animation
  const canvas = document.getElementById('bgCanvas');
  const ctx = canvas.getContext('2d');
  let width, height, nodes = [];
  const nodeCount = 38, maxDist = 140;
  function resize(){
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();
  nodes = [];
  for(let i=0; i<nodeCount; i++){
    nodes.push({ x: Math.random()*width, y: Math.random()*height, vx: (Math.random()-0.5)*1.35, vy: (Math.random()-0.5)*1.35 });
  }
  function animate(){
    ctx.clearRect(0,0,width,height);
    for(let i=0; i<nodeCount; i++){
      for(let j=i+1; j<nodeCount; j++){
        const dx = nodes[i].x - nodes[j].x;
        const dy = nodes[i].y - nodes[j].y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist < maxDist){
          ctx.strokeStyle = `rgba(0,109,119,${1-dist/maxDist})`;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(nodes[i].x, nodes[i].y);
          ctx.lineTo(nodes[j].x, nodes[j].y);
          ctx.stroke();
        }
      }
    }
    nodes.forEach(n=>{
      n.x += n.vx;
      n.y += n.vy;
      if(n.x < 0 || n.x > width) n.vx *= -1;
      if(n.y < 0 || n.y > height) n.vy *= -1;
      ctx.fillStyle = '#198b9b';
      ctx.beginPath();
      ctx.arc(n.x,n.y,4,0, Math.PI*2);
      ctx.fill();
    });
    requestAnimationFrame(animate);
  }
  animate();
</script>
</body>
</html>
